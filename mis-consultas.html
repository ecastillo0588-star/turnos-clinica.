<!-- mis-consultas.html -->
<section id="mc" class="mc">
  <style>
    /* ====== Override ancho de la “card” del dashboard para este panel ====== */
    #main-content.card { max-width: 1400px; width: 100%; }
    @media (min-width: 1600px){ #main-content.card { max-width: 92vw; } }

    /* ====== Estilos base ====== */
    .mc { display: grid; gap: 18px; }
    .mc h2 { margin: 0 0 4px; color: #381e60; font-weight: 700; }

    .mc-toolbar {
      display: grid;
      gap: 10px;
      grid-template-columns: 1fr;
      align-items: end;
    }
    @media (min-width: 820px){
      .mc-toolbar {
        grid-template-columns: repeat(12, minmax(0,1fr));
        align-items: end;
      }
    }

    .mc-field { display: grid; gap: 6px; }
    .mc-field label { font-size: 12px; color: #6b6480; }
    .mc-field input, .mc-field select {
      background: #fbfbfe; border: 1.5px solid #ece5fc; border-radius: 8px;
      padding: 8px 10px; font-size: 14px; color: #381e60;
      outline: none;
    }
    .mc-field input:focus, .mc-field select:focus { box-shadow: 0 0 0 3px rgba(139,107,217,.25); }

    .mc-legend {
      font-size: 13px; color: #6b6480; margin-top: 2px;
    }

    .mc-btn {
      border: 0; background: #7656b0; color: #fff; padding: 10px 14px; border-radius: 10px;
      font-weight: 600; cursor: pointer; transition: transform .06s ease, box-shadow .18s ease;
    }
    .mc-btn:hover { box-shadow: 0 6px 14px rgba(118,86,176,.18); }
    .mc-btn:active { transform: translateY(1px); }

    /* ====== Chips de filtros activos ====== */
    .chips { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    .chip {
      display: inline-flex; align-items: center; gap: 8px;
      border: 1px solid #e2dcf7; background: #f6f3fd; color: #4f3b7a;
      border-radius: 999px; padding: 6px 10px; font-size: 13px;
    }
    .chip .x { cursor: pointer; font-weight: 700; color: #8b6bd9; }
    .chip .x:hover { color: #5d3fae; }

    /* ====== KPIs ====== */
    .mc-kpis {
      display: grid; gap: 12px; grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    .kpi {
      background: #fff; border: 1px solid #eee8ff; border-radius: 12px; padding: 14px 16px;
      display: grid; gap: 6px; box-shadow: 0 2px 8px rgba(80,60,160,.06);
    }
    .kpi .label { font-size: 12px; color: #6b6480; }
    .kpi .value { font-size: 22px; color: #381e60; font-weight: 800; }

    /* ====== Grillas de gráficos ====== */
    .mc-charts {
      display: grid; gap: 14px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 1100px){
      .mc-charts {
        grid-template-columns: 2fr 1fr 1fr;
        grid-auto-rows: minmax(0, auto);
        align-items: stretch;
      }
      .chart-card.timeline {
        grid-column: 1 / -1;   /* ocupa todo el ancho arriba */
      }
    }

    .chart-card {
      background: #fff; border: 1px solid #eee8ff; border-radius: 12px; padding: 12px;
      box-shadow: 0 2px 8px rgba(80,60,160,.06);
      display: grid; grid-template-rows: auto 1fr; gap: 10px;
      min-height: 280px;
    }
    .chart-card.timeline { min-height: 340px; }

    .chart-title {
      font-size: 13px; color: #6b6480; display: flex; justify-content: space-between; align-items: center;
    }
    .chart-body {
      min-height: 0; /* evita estiramiento */
    }
    .chart-body canvas {
      width: 100% !important;
      height: 100% !important;
      display: block;
    }

    /* ====== Tabla ====== */
    .mc-table-wrap {
      background: #fff; border: 1px solid #eee8ff; border-radius: 12px; padding: 12px;
      box-shadow: 0 2px 8px rgba(80,60,160,.06);
      overflow: auto;
    }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      text-align: left; font-size: 12px; color: #6b6480; font-weight: 600;
      padding: 10px 8px; border-bottom: 1px solid #eee8ff;
      white-space: nowrap;
    }
    tbody td { padding: 10px 8px; border-bottom: 1px solid #f4f0ff; font-size: 14px; color: #381e60; }
    tbody tr:hover { background: #faf7ff; }

    /* vacío / estado */
    .mc-empty { color:#6b6480; font-size: 14px; text-align: center; padding: 12px 0; }
  </style>

  <h2>Mis consultas</h2>

  <!-- Filtros -->
  <div class="mc-toolbar">
    <div class="mc-field" style="grid-column: span 2;">
      <label>Desde</label>
      <input id="mc-desde" type="date">
    </div>
    <div class="mc-field" style="grid-column: span 2;">
      <label>Hasta</label>
      <input id="mc-hasta" type="date">
    </div>
    <div class="mc-field" style="grid-column: span 4;">
      <label>Centro médico</label>
      <select id="mc-centro">
        <option value="">Todos los centros</option>
      </select>
    </div>
    <div class="mc-field" style="grid-column: span 2;">
      <label>Granularidad</label>
      <select id="mc-gran">
        <option value="day">Día</option>
        <option value="week">Semana</option>
        <option value="month">Mes</option>
      </select>
    </div>
    <div class="mc-field" style="grid-column: span 2;">
      <label>&nbsp;</label>
      <button id="mc-refresh" class="mc-btn">Actualizar</button>
    </div>

    <div class="mc-legend" style="grid-column: 1 / -1;">
      <span id="mc-legend">—</span>
    </div>

    <!-- Chips de filtros activos (se rellenan desde JS si hacés clic en los gráficos) -->
    <div id="mc-chips" class="chips" style="grid-column: 1 / -1;"></div>
  </div>

  <!-- KPIs -->
  <div class="mc-kpis">
    <div class="kpi">
      <div class="label">Atenciones</div>
      <div id="mc-kpi-consultas" class="value">0</div>
    </div>
    <div class="kpi">
      <div class="label">Cobrado</div>
      <div id="mc-kpi-cobrado" class="value">$ 0</div>
    </div>
    <div class="kpi">
      <div class="label">Pendiente</div>
      <div id="mc-kpi-pendiente" class="value">$ 0</div>
    </div>
  </div>

  <!-- Charts -->
  <div class="mc-charts">
    <div class="chart-card timeline">
      <div class="chart-title">
        <span>Evolución de atenciones</span>
        <small style="color:#8b6bd9;">clic para filtrar</small>
      </div>
      <div class="chart-body"><canvas id="mc-chart-timeline"></canvas></div>
    </div>

    <div class="chart-card">
      <div class="chart-title">
        <span>Obras sociales</span>
        <small style="color:#8b6bd9;">clic para filtrar</small>
      </div>
      <div class="chart-body"><canvas id="mc-chart-os"></canvas></div>
    </div>

    <div class="chart-card">
      <div class="chart-title">
        <span>Centros médicos</span>
        <small style="color:#8b6bd9;">clic para filtrar</small>
      </div>
      <div class="chart-body"><canvas id="mc-chart-centros"></canvas></div>
    </div>

    <div class="chart-card">
      <div class="chart-title">
        <span>Estados</span>
        <small style="color:#8b6bd9;">clic para filtrar</small>
      </div>
      <div class="chart-body"><canvas id="mc-chart-estados"></canvas></div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="mc-table-wrap">
    <div id="mc-empty" class="mc-empty" style="display:none;">Cargando…</div>
    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Hora</th>
          <th>Centro</th>
          <th>Paciente</th>
          <th>Estado</th>
          <th style="text-align:right;">Copago</th>
          <th style="text-align:right;">Pagado</th>
        </tr>
      </thead>
      <tbody id="mc-tbody"></tbody>
    </table>
  </div>

  <!-- Debug opcional -->
  <pre id="mc-debug-pre" style="display:none; background:#f9f7ff; border:1px solid #eee8ff; padding:10px; border-radius:8px; max-height:200px; overflow:auto;"></pre>
</section>
