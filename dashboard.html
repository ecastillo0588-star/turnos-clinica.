<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel - EG Health Solutions</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="app.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div>
        <div class="brand-title">EG Health</div>
        <div class="brand-sub">Centro: <span id="centro-nombre"></span></div>
      </div>
      <nav class="menu">
        <button id="btn-dashboard" class="active">Inicio</button>
        <button id="btn-pacientes">Pacientes</button>
        <button id="btn-profesionales">Profesionales</button>
        <div class="separator"></div>
        <div class="submenu-toggle" id="submenu-toggle">
          <span>Reportes</span>
          <span class="caret">&#9654;</span>
        </div>
        <div class="submenu-items" id="submenu-items">
          <button class="menu-subitem" id="btn-reporte-1">Turnos</button>
          <button class="menu-subitem" id="btn-reporte-2">Facturación</button>
        </div>
      </nav>
      <div class="settings-slot">
        <button class="settings-btn btn" id="btn-config">Configuración</button>
      </div>
    </aside>
    <main class="main">
      <div class="topbar">
        <div>
          <span class="badge" id="user-rol"></span>
        </div>
        <button class="btn" id="btn-logout">Cerrar sesión</button>
      </div>
      <div id="main-content" class="card">
        <h2>Bienvenido</h2>
        <img src="https://i.postimg.cc/ZY8mGGf2/Chat-GPT-Image-30-ago-2025-17-14-28.png" alt="EG Health Solutions Logo" style="max-width:140px;margin-bottom:18px;display:block;">
        <p>Selecciona una opción del menú lateral.</p>
      </div>
      <div id="configuracion-panel" class="hidden"></div>
    </main>
  </div>
  <script type="module">
    // Datos básicos
    document.getElementById('centro-nombre').textContent = localStorage.getItem('centro_medico_nombre') || 'No asignado';
    document.getElementById('user-rol').textContent = localStorage.getItem('user_rol') || '';

    // Sidebar submenu toggle
    const submenuToggle = document.getElementById('submenu-toggle');
    const submenuItems = document.getElementById('submenu-items');
    submenuToggle.addEventListener('click', function() {
      submenuItems.classList.toggle('show');
      submenuToggle.classList.toggle('open');
    });

    // Mostrar y ocultar paneles
    function showPanel(panel) {
      document.getElementById('main-content').classList.add('hidden');
      document.getElementById('configuracion-panel').classList.add('hidden');
      if(panel === 'dashboard') document.getElementById('main-content').classList.remove('hidden');
      if(panel === 'config') document.getElementById('configuracion-panel').classList.remove('hidden');
    }

    document.getElementById('btn-dashboard').addEventListener('click', function() {
      setActiveMenu(this);
      showPanel('dashboard');
    });
    document.getElementById('btn-pacientes').addEventListener('click', function() {
      setActiveMenu(this);
      showPanel('dashboard');
      document.getElementById('main-content').innerHTML = `<h2>Pacientes</h2><p>Aquí irá la gestión de pacientes...</p>`;
    });
    document.getElementById('btn-profesionales').addEventListener('click', function() {
      setActiveMenu(this);
      showPanel('dashboard');
      document.getElementById('main-content').innerHTML = `<h2>Profesionales</h2><p>Aquí irá la gestión de profesionales...</p>`;
    });
    document.getElementById('btn-reporte-1').addEventListener('click', function() {
      setActiveSubMenu(this);
      showPanel('dashboard');
      document.getElementById('main-content').innerHTML = `<h2>Reporte de turnos</h2><p>Gráficos e información de turnos.</p>`;
    });
    document.getElementById('btn-reporte-2').addEventListener('click', function() {
      setActiveSubMenu(this);
      showPanel('dashboard');
      document.getElementById('main-content').innerHTML = `<h2>Reporte de facturación</h2><p>Gráficos e información de facturación.</p>`;
    });
    document.getElementById('btn-config').addEventListener('click', async function() {
      setActiveMenu(this);
      showPanel('config');
      await cargarPanelConfiguracion();
    });
    document.getElementById('btn-logout').addEventListener('click', function() {
      localStorage.clear();
      window.location.href = "index.html";
    });

    function setActiveMenu(btn) {
      document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');
      document.querySelectorAll('.menu-subitem').forEach(b => b.classList.remove('active'));
    }
    function setActiveSubMenu(btn) {
      setActiveMenu(null);
      document.querySelectorAll('.menu-subitem').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    // Panel de configuración: carga el archivo configuracion.html y lo inserta en el div
    async function cargarPanelConfiguracion() {
      // Solicita el archivo configuracion.html vía fetch
      const resp = await fetch('configuracion.html');
      let html = await resp.text();
      // Inserta el HTML en el panel
      document.getElementById('configuracion-panel').innerHTML = html;
      // Los <script type="module"> internos de configuracion.html NO se ejecutan automáticamente,
      // así que detecta y evalúa los scripts (solo si son de tipo module)
      const panel = document.getElementById('configuracion-panel');
      Array.from(panel.querySelectorAll('script[type="module"]')).forEach(oldScript => {
        const newScript = document.createElement('script');
        newScript.type = 'module';
        if (oldScript.src) newScript.src = oldScript.src;
        else newScript.textContent = oldScript.textContent;
        document.body.appendChild(newScript);
      });
    }
  </script>
</body>
</html>
