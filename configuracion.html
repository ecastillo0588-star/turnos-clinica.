<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuración - EG Health Solutions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #f6f3fa;}
    .card { background: #fff; padding: 27px 22px; border-radius: 18px; box-shadow: 0 2px 8px rgba(80,60,160,.10); }
    .config-tabs { margin-bottom:22px; display:flex; gap:9px; }
    .tab-btn { background:#ece3fa; border:none; border-radius:7px 7px 0 0; padding:8px 22px; font-size:16px; color:#7656b0; cursor:pointer; font-weight:500; }
    .tab-btn.active { background:#fff; border-bottom:2px solid #7656b0; color:#381e60; }
    .config-tab-content { background: #fff; border-radius:0 0 13px 13px; box-shadow:0 1px 6px rgba(80,60,160,.07); padding: 18px 16px 2px 16px; }
    .tab-panel { display:none; }
    .tab-panel.active { display:block; }
    .btn { background: #7656b0; color: #fff; border: none; border-radius: 6px; padding: 6px 16px; cursor:pointer; margin: 3px;}
    .btn.primary { background: #7656b0; }
    .btn:hover { background: #7f62b6; }
    .muted { color: #6b6480; font-size: 13px; }
    input, select { border: 1px solid #e3d8f6; border-radius: 6px; padding: 5px 8px; font-size:15px; }
    form label { font-size:15px; color:#381e60; margin-bottom:3px; display:block; }
  </style>
</head>
<body>

<!-- Configuración EG Health Solutions - Menú Tabulado -->
<div class="card config-grid" style="max-width: 900px; margin: 40px auto;">
  <h2 style="margin-bottom:18px;">Configuración</h2>
  <nav class="config-tabs">
    <button class="tab-btn active" data-tab="agenda">Configurar Agenda</button>
    <button class="tab-btn" data-tab="duracion">Duración de Turnos</button>
    <button class="tab-btn" data-tab="centros">Centros Médicos</button>
    <button class="tab-btn" data-tab="asistentes">Asistentes</button>
  </nav>
  <div class="config-tab-content">
    <!-- Agenda -->
    <section id="tab-agenda" class="tab-panel active">
      <div id="agenda-generador-html">
        <div class="muted">Cargando generador de agenda...</div>
      </div>
    </section>
    <!-- Duración de Turnos -->
    <section id="tab-duracion" class="tab-panel">
      <div id="duracion-turnos-html">
        <div class="muted">Cargando configuración de duración de turnos...</div>
      </div>
    </section>
    <!-- Centros Médicos -->
    <section id="tab-centros" class="tab-panel">
      <div id="centros-medicos-html">
        <div class="muted">Cargando configuración de centros médicos...</div>
      </div>
    </section>
    <!-- Asistentes -->
    <section id="tab-asistentes" class="tab-panel">
      <div id="asistentes-html">
        <div class="muted">Cargando configuración de asistentes...</div>
      </div>
    </section>
  </div>
</div>

<script type="module">
// Tabs interactividad
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    this.classList.add('active');
    const tab = this.getAttribute('data-tab');
    document.querySelectorAll('.tab-panel').forEach(panel=>{
      panel.classList.remove('active');
      if(panel.id==='tab-'+tab) panel.classList.add('active');
    });
    // Cargar htmls externos solo cuando se muestra el tab correspondiente
    if(tab==='agenda') cargarAgendaGenerador();
    if(tab==='duracion') cargarDuracionTurnos();
    if(tab==='centros') cargarCentrosMedicos();
    if(tab==='asistentes') cargarAsistentes();
  });
});

// --- Helpers de carga dinámica ---
async function loadExternalHtml(url, targetId, errorMsg) {
  const espacio = document.getElementById(targetId);
  try {
    const resp = await fetch(url);
    if (!resp.ok) {
      espacio.innerHTML = `<div class="muted" style="color:#b00020;">${errorMsg}</div>`;
      return;
    }
    let html = await resp.text();
    espacio.innerHTML = html;
    // Re-ejecutar scripts tipo module embebidos
    Array.from(espacio.querySelectorAll('script[type="module"]')).forEach(oldScript => {
      const newScript = document.createElement('script');
      newScript.type = 'module';
      if (oldScript.src) newScript.src = oldScript.src;
      else newScript.textContent = oldScript.textContent;
      document.body.appendChild(newScript);
    });
  } catch (e) {
    espacio.innerHTML = `<div class="muted" style="color:#b00020;">${errorMsg}</div>`;
  }
}

// --- Cargas diferidas por tab ---
let agendaCargada = false;
async function cargarAgendaGenerador() {
  if (agendaCargada) return;
  await loadExternalHtml('agenda-generador.html', 'agenda-generador-html', 'Error al cargar agenda-generador.html');
  agendaCargada = true;
}

let duracionCargada = false;
async function cargarDuracionTurnos() {
  if (duracionCargada) return;
  await loadExternalHtml('duracion-turnos.html', 'duracion-turnos-html', 'Error al cargar duracion-turnos.html');
  duracionCargada = true;
}

let centrosCargado = false;
async function cargarCentrosMedicos() {
  if (centrosCargado) return;
  await loadExternalHtml('centros-medicos.html', 'centros-medicos-html', 'Error al cargar centros-medicos.html');
  centrosCargado = true;
}

let asistentesCargado = false;
async function cargarAsistentes() {
  if (asistentesCargado) return;
  await loadExternalHtml('asistentes.html', 'asistentes-html', 'Error al cargar asistentes.html');
  asistentesCargado = true;
}

// Cargar agenda por defecto al inicio
if(document.querySelector('.tab-btn.active').getAttribute('data-tab')==='agenda') {
  cargarAgendaGenerador();
}
</script>

</body>
</html>
