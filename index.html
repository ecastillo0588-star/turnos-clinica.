<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Visor de Tablas Supabase con Logs</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    .tab { display: inline-block; margin: 0 10px; padding: 6px 12px; background: #eee; cursor: pointer; border-radius: 4px; }
    .tab.active { background: #007bff; color: white; }
    #error-message { color: red; margin-top: 1em; }
    table { border-collapse: collapse; margin-top: 1em; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    th { background: #f7f7f7; }
  </style>
</head>
<body>
  <h2>Visor de Tablas Supabase (con logs)</h2>
  <div id="tabs"></div>
  <div id="table-container"></div>
  <div id="error-message"></div>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
    // Reemplaza estos valores por los de tu proyecto
    const supabaseUrl = 'https://vwkszvdvswznlgxlfdtz.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ3a3N6dmR2c3d6bmdseGZkdHoiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTY5MTQzMzg3MCwiZXhwIjoxOTk2MDA5ODcwfQ.qJzKqA5K5t8Z9t1gBGtvJ8EYU7W8Q2cAgq8wL5hUOBo';
    const supabase = createClient(supabaseUrl, supabaseAnonKey);

    // Nombres de tablas
    const tables = [
      "centros_medicos",
      "profesionales",
      "profiles",
      "agenda",
      "pacientes",
      "profesional_centro",
      "medico_config",
      "turnos"
    ];

    // Render tabs
    const tabsDiv = document.getElementById('tabs');
    tables.forEach((t, idx) => {
      const tab = document.createElement('span');
      tab.textContent = t;
      tab.className = 'tab' + (idx === 0 ? ' active' : '');
      tab.onclick = () => {
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        tab.classList.add('active');
        fetchTable(t);
      };
      tabsDiv.appendChild(tab);
    });

    // Fetch table data
    async function fetchTable(tableName) {
      document.getElementById('error-message').textContent = '';
      document.getElementById('table-container').innerHTML = '<em>Cargando...</em>';
      try {
        const { data, error } = await supabase
          .from(tableName)
          .select('*')
          .limit(50);

        // Log para debugging en consola
        console.log(`Consulta a tabla: ${tableName}`);
        console.log('Data:', data);
        console.log('Error:', error);

        if (error) {
          document.getElementById('error-message').textContent = `Error al consultar ${tableName}: ${error.message}`;
          document.getElementById('table-container').innerHTML = '';
          return;
        }
        if (!data || data.length === 0) {
          document.getElementById('table-container').innerHTML = '<em>No hay datos en la tabla.</em>';
          return;
        }
        renderTable(data);
      } catch (err) {
        console.error(`Error inesperado al consultar ${tableName}:`, err);
        document.getElementById('error-message').textContent = `Error inesperado al consultar ${tableName}: ${err.message}`;
        document.getElementById('table-container').innerHTML = '';
      }
    }

    // Render table
    function renderTable(data) {
      const keys = Object.keys(data[0]);
      let html = '<table><thead><tr>' + keys.map(k => `<th>${k}</th>`).join('') + '</tr></thead><tbody>';
      data.forEach(row => {
        html += '<tr>' + keys.map(k => `<td>${row[k]}</td>`).join('') + '</tr>';
      });
      html += '</tbody></table>';
      document.getElementById('table-container').innerHTML = html;
    }

    // Inicial: mostrar la primera tabla
    fetchTable(tables[0]);
  </script>
</body>
</html>
