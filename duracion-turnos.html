<!-- ... contenido anterior ... -->

<div class="duracion-turnos-card" style="max-width: 650px; margin: 30px auto;">
  <h3>Duración de Turnos</h3>
  
  <div style="margin-bottom:24px;">
    <label for="centro_id"><b>Centro Médico</b></label>
    <div style="display:flex; gap:12px; align-items: center;">
      <select id="centro_id" name="centro_id" required style="max-width:240px;">
        <option disabled selected value="">Cargando centros...</option>
      </select>
      <button type="button" id="crear-centro-btn" class="btn">Crear centro médico</button>
    </div>
    <span id="centros-status" class="muted" style="margin-left:12px;"></span>
  </div>

  <!-- ... formulario de duración ... -->
</div>

<!-- Modal para crear centro médico -->
<div id="modal-centro" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="cerrar-modal-centro">&times;</span>
    <h4>Crear nuevo centro médico</h4>
    <form id="form-crear-centro">
      <input type="text" id="nuevo_centro_nombre" placeholder="Nombre del centro" required>
      <input type="text" id="nuevo_centro_direccion" placeholder="Dirección">
      <input type="text" id="nuevo_centro_telefono" placeholder="Teléfono">
      <input type="email" id="nuevo_centro_email" placeholder="Email">
      <textarea id="nuevo_centro_notas" placeholder="Notas"></textarea>
      <button type="submit" class="btn primary" style="margin-top:10px;">Guardar centro</button>
      <div id="modal-centro-status" class="muted" style="margin-top:10px;"></div>
    </form>
  </div>
</div>

<script type="module">
// ... config y funciones previas ...

const crearCentroBtn = document.getElementById('crear-centro-btn');
const modalCentro = document.getElementById('modal-centro');
const cerrarModalCentro = document.getElementById('cerrar-modal-centro');
const formCrearCentro = document.getElementById('form-crear-centro');
const modalCentroStatus = document.getElementById('modal-centro-status');

// Abrir modal
crearCentroBtn.addEventListener('click', () => {
  modalCentro.style.display = 'block';
  modalCentroStatus.textContent = '';
  formCrearCentro.reset();
});

// Cerrar modal
cerrarModalCentro.addEventListener('click', () => {
  modalCentro.style.display = 'none';
});
window.addEventListener('click', (e) => {
  if (e.target === modalCentro) modalCentro.style.display = 'none';
});

// Crear centro médico y asociar al profesional
formCrearCentro.addEventListener('submit', async function(e) {
  e.preventDefault();
  const nombre = document.getElementById('nuevo_centro_nombre').value.trim();
  const direccion = document.getElementById('nuevo_centro_direccion').value.trim();
  const telefono = document.getElementById('nuevo_centro_telefono').value.trim();
  const email = document.getElementById('nuevo_centro_email').value.trim();
  const notas = document.getElementById('nuevo_centro_notas').value.trim();

  if (!nombre) {
    modalCentroStatus.textContent = 'El nombre es obligatorio.';
    return;
  }
  modalCentroStatus.textContent = 'Guardando centro...';

  // Crear centro
  const { data: centro, error: errorCentro } = await supabase
    .from('centros_medicos')
    .insert([{ nombre, direccion, telefono, email, notas }])
    .select();
  if (errorCentro || !centro || !centro[0]) {
    modalCentroStatus.textContent = 'Error al crear centro médico';
    return;
  }
  // Asociar centro al profesional
  const { error: errorPC } = await supabase
    .from('profesional_centro')
    .insert({ profesional_id: profesionalId, centro_id: centro[0].id });
  if (errorPC) {
    modalCentroStatus.textContent = 'Error al asociar centro médico';
    return;
  }
  modalCentroStatus.textContent = 'Centro creado y asociado exitosamente!';
  // Recargar lista de centros
  await cargarCentros();
  centroSelect.value = centro[0].id;
  await cargarConfiguracionDuracion(centro[0].id);
  setTimeout(() => { modalCentro.style.display = 'none'; }, 1200);
});
</script>

<style>
/* ... estilos previos ... */
.modal { position:fixed; z-index:999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18); display:flex; align-items:center; justify-content:center;}
.modal-content { background:#fff; padding:28px 22px 20px 22px; border-radius:14px; min-width:300px; max-width:350px; position:relative; box-shadow:0 2px 18px rgba(80,60,160,.18);}
.close { position:absolute; right:12px; top:10px; font-size:20px; color:#7656b0; cursor:pointer;}
.modal-content h4 { color:#381e60; margin-bottom:16px;}
.modal-content input, .modal-content textarea { width:100%; margin-bottom:10px; }
</style>
