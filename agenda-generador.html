<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Agenda de Disponibilidad</title>
  <style>
    .agenda-generador { max-width: 740px; margin: 24px auto; }
    .horarios-table-compact { border-collapse:collapse;width:100%;background:#f7f4fa;font-size:13px; }
    .horarios-table-compact th, .horarios-table-compact td { border:1px solid #e3d8f6;padding:5px;text-align:center; }
    .horarios-table-compact th { background:#ece3fa;font-weight:600;font-size:13px; }
    .input-hora { width:70px; padding:2px 4px; font-size:13px; border-radius:5px; border:1px solid #d2c6ed; }
    .horarios-table-compact td input[type="checkbox"] { transform:scale(1.1); }
    .btn.primary { background: #7656b0; }
    .btn { background: #7656b0; color: #fff; border: none; border-radius: 6px; padding: 5px 12px; cursor:pointer; margin: 2px;}
    .btn:disabled { background: #d2c6ed; color:#fff; cursor:not-allowed;}
    .btn:hover:not(:disabled) { background: #7f62b6; }
    .card { background: #fff; padding: 22px; border-radius: 16px; box-shadow: 0 2px 8px rgba(80,60,160,.09); }
    .bloque-fechas label, .bloque-duracion-turno label { font-size:13px; }
    .bloque-nombre-agenda label { font-size:15px; margin-bottom:2px; color:#381e60; }
    .obligatorio { color: #c2001d; font-weight:700; font-size:1em; }
    .hidden { display:none; }
    .agenda-footer-sticky { position: sticky; bottom: 0; left: 0; background: #f7f4fa; width: 100%; padding: 14px 0 10px 0; display: flex; align-items: center; justify-content: flex-start; z-index: 99; border-top: 1px solid #ece3fa; }
    .centro-form-block { background: #f3eafc; border-radius: 8px; box-shadow: 0 1px 6px rgba(120,80,180,.07); padding: 14px 16px 12px 16px; margin: 8px 0; max-width:320px; }
    .centro-form-block h4 {margin:0 0 8px;color:#7656b0;font-size:16px;}
    .centro-form-block label {display:block;font-size:13px;margin:8px 0 2px;}
    .centro-form-block input {width:95%;margin-bottom:4px;}
    .agendas-list-card { max-width:740px; margin: 28px auto 18px; background: #fff; border-radius: 16px; box-shadow: 0 2px 8px rgba(80,60,160,.08); padding: 18px 22px; }
    .agendas-list-card h3 { margin:0 0 14px; color:#391e60; font-size:18px;}

    /* --- UI de búsqueda y sugerencias --- */
    .agenda-search { position: relative; max-width: 360px; margin: 6px 0 8px; }
    .agenda-search input { width:100%; padding:6px 8px; border:1px solid #d2c6ed; border-radius:8px; font-size:14px; background:#fff; }
    .suggestions { position:absolute; top:100%; left:0; right:0; background:#fff; border:1px solid #e3d8f6;
      box-shadow:0 2px 8px rgba(80,60,160,.08); max-height:220px; overflow:auto; border-radius:8px; z-index:100; }
    .suggestions.hidden { display:none; }
    .suggestions .item { padding:6px 10px; cursor:pointer; }
    .suggestions .item:hover { background:#f7f4fa; }

    .agenda-table-controls { margin:10px 0; }
    .agenda-table td { text-align:left; }
    .agenda-pagination { margin-top:10px; display:flex; align-items:center; gap:10px; }
  </style>
</head>
<body>
<div class="card agenda-generador">
  <h2>Generar Agenda de Disponibilidad</h2>

  <section class="bloque-nombre-agenda">
    <label for="nombre-agenda"><b>Nombre de la agenda <span class="obligatorio">*</span></b></label><br>
    <input type="text" id="nombre-agenda" placeholder="Ejemplo: Agenda Septiembre 2025" style="max-width:300px;" required>
  </section>

  <section class="bloque-fechas" style="margin-top:14px;">
    <div style="display:flex;flex-wrap:wrap;gap:14px;align-items:center;">
      <div>
        <label for="fecha-inicio"><b>Fecha inicio <span class="obligatorio">*</span></b></label><br>
        <input type="date" id="fecha-inicio" required>
      </div>
      <div>
        <label for="fecha-fin"><b>Fecha fin <span class="obligatorio">*</span></b></label><br>
        <input type="date" id="fecha-fin" required>
      </div>
      <div>
        <label for="centro-agenda"><b>Centro médico <span class="obligatorio">*</span></b></label><br>
        <select id="centro-agenda" required>
          <option value="">Seleccione un centro...</option>
        </select>
        <button type="button" class="btn" id="btn-nuevo-centro" style="margin-top:6px;">Agregar nuevo centro</button>
      </div>
    </div>

    <div id="nuevo-centro-form" class="hidden centro-form-block" aria-live="polite">
      <h4>Nuevo Centro Médico</h4>
      <div>
        <label for="nuevo-centro-nombre">Nombre <span class="obligatorio">*</span></label>
        <input type="text" id="nuevo-centro-nombre" required>
      </div>
      <div>
        <label for="nuevo-centro-direccion">Dirección</label>
        <input type="text" id="nuevo-centro-direccion">
      </div>
      <div>
        <label for="nuevo-centro-telefono">Teléfono</label>
        <input type="text" id="nuevo-centro-telefono">
      </div>
      <div>
        <label for="nuevo-centro-email">Email</label>
        <input type="email" id="nuevo-centro-email">
      </div>
      <div>
        <label for="nuevo-centro-notas">Notas</label>
        <input type="text" id="nuevo-centro-notas">
      </div>
      <button type="button" class="btn" id="guardar-nuevo-centro">Guardar</button>
      <button type="button" class="btn" id="cancelar-nuevo-centro">Cancelar</button>
    </div>
  </section>

  <section class="bloque-horario-dias" style="margin-top:18px;">
    <h3 style="margin-bottom:9px;">Horarios por Día</h3>
    <table class="horarios-table-compact">
      <thead>
        <tr>
          <th style="width:60px;">Día</th>
          <th style="width:70px;">Mañana<br>Inicio</th>
          <th style="width:70px;">Mañana<br>Fin</th>
          <th style="width:70px;">Tarde<br>Inicio</th>
          <th style="width:70px;">Tarde<br>Fin</th>
          <th style="width:55px;">Habilitar</th>
        </tr>
      </thead>
      <tbody id="horarios-body"></tbody>
    </table>
  </section>
</div>

<div class="agenda-footer-sticky">
  <button class="btn primary" id="btn-generar-agenda" disabled title="Debe completar los campos obligatorios*">Generar agenda</button>
  <span id="msg-agenda" style="margin-left:18px;"></span>
</div>

<!-- NUEVA VISTA: buscar / listar / paginar / eliminar agendas -->
<div class="agendas-list-card" id="agendas-list-card">
  <h3>Agendas</h3>

  <label for="agenda-search-input"><b>Buscar agenda por nombre</b></label>
  <div class="agenda-search">
    <input type="text" id="agenda-search-input" placeholder="Escribí para buscar (ej. 'sept')" autocomplete="off" aria-autocomplete="list" aria-expanded="false" aria-haspopup="listbox">
    <div id="agenda-suggestions" class="suggestions hidden" role="listbox"></div>
  </div>

  <div class="agenda-table-controls">
    <label>Mostrar
      <select id="agenda-page-size">
        <option value="5" selected>5</option>
        <option value="10">10</option>
        <option value="50">50</option>
      </select>
      registros
    </label>
  </div>

  <table class="horarios-table-compact agenda-table">
    <thead>
      <tr>
        <th style="text-align:left;">Nombre de Agenda</th>
        <th style="width:100px;">Rangos</th>
        <th style="width:140px;">Acciones</th>
      </tr>
    </thead>
    <tbody id="agenda-table-body">
      <tr><td colspan="3" style="text-align:left;padding:8px;">Cargando…</td></tr>
    </tbody>
  </table>

  <div class="agenda-pagination">
    <button class="btn" id="agenda-prev" disabled>&laquo; Anterior</button>
    <span id="agenda-page-info"></span>
    <button class="btn" id="agenda-next" disabled>Siguiente &raquo;</button>
  </div>

  <span id="msg-eliminar-agenda" style="margin-left:0;"></span>
</div>

<script type="module">
import supabase from './supabaseClient.js';
import { isValidMorning, isValidAfternoon } from './validators.js';

console.assert(supabase && typeof supabase.from === 'function', '❌ Supabase no inicializado: revisá supabaseClient.js (default export)');

// === Sesión (igual que antes) ===
const profesional_id    = localStorage.getItem('profesional_id');
const centro_default_id = localStorage.getItem('centro_medico_id');
if (!profesional_id || !centro_default_id) {
  alert('Sesión no iniciada o datos incompletos. Redirigiendo a login.');
  window.location.href = "index.html";
}

// === Constantes y helpers (mismo comportamiento) ===
const DIAS = [
  {nombre:'lunes', label:'LUN'}, {nombre:'martes', label:'MAR'}, {nombre:'miercoles', label:'MIÉR'},
  {nombre:'jueves', label:'JUEV'}, {nombre:'viernes', label:'VIER'}, {nombre:'sabado', label:'SÁB'}
];

// Helpers de fecha (local) – evitamos UTC
const parseLocalDate = (s) => { const [y, m, d] = s.split('-').map(Number); return new Date(y, m - 1, d); };
const formatLocalYMD = (d) => { const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const day = String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${day}`; };

// ------ UI horarios (idéntico a lo que ya usabas)
function generarOpcionesHora(inicio, fin) {
  const opciones = ['<option value="">--</option>'];
  for (let h = inicio; h < fin; h++) {
    for (let m = 0; m < 60; m += 15) {
      const hh = (h < 10 ? '0' : '') + h;
      const mm = (m < 10 ? '0' : '') + m;
      opciones.push(`<option value="${hh}:${mm}">${hh}:${mm}</option>`);
    }
  }
  const end = (fin<10?'0':'')+fin;
  opciones.push(`<option value="${end}:00">${end}:00</option>`);
  return opciones.join('');
}

function renderTablaHorarios() {
  const tbody = document.getElementById('horarios-body');
  tbody.innerHTML = '';
  DIAS.forEach((dia, idx)=>{
    const opcionesMañana = generarOpcionesHora(7, 13);
    const opcionesTarde  = generarOpcionesHora(13, 21);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="font-size:13px;"><b>${dia.label}</b></td>
      <td><select name="tm_ini_${idx}" class="input-hora" disabled>${opcionesMañana}</select></td>
      <td><select name="tm_fin_${idx}" class="input-hora" disabled>${opcionesMañana}</select></td>
      <td><select name="tt_ini_${idx}" class="input-hora" disabled>${opcionesTarde}</select></td>
      <td><select name="tt_fin_${idx}" class="input-hora" disabled>${opcionesTarde}</select></td>
      <td><input type="checkbox" name="hab_${idx}" /></td>
    `;
    tbody.appendChild(tr);
  });

  DIAS.forEach((_, idx)=>{
    document.querySelector(`[name="hab_${idx}"]`).onchange = function() {
      const disabled = !this.checked;
      ['tm_ini','tm_fin','tt_ini','tt_fin'].forEach(prefix=>{
        const sel = document.querySelector(`[name="${prefix}_${idx}"]`);
        sel.disabled = disabled;
        if (disabled) sel.value = "";
      });
    };
  });
}
renderTablaHorarios();

// ------ Centros activos (igual lógica)
async function cargarCentros() {
  const selector = document.getElementById('centro-agenda');
  selector.innerHTML = '<option value="">Seleccione un centro...</option>';
  try {
    const { data: centros, error } = await supabase
      .from('centros_medicos')
      .select('id, nombre')
      .eq('activo', true)
      .order('nombre', { ascending: true });
    if (error) throw error;
    (centros || []).forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.id;
      opt.textContent = c.nombre;
      selector.appendChild(opt);
    });
    if (centro_default_id && selector.querySelector(`option[value="${centro_default_id}"]`)) {
      selector.value = centro_default_id;
    }
  } catch (e) {
    const opt = document.createElement('option');
    opt.value = "";
    opt.textContent = "Error al cargar";
    opt.className = "error-option";
    selector.appendChild(opt);
    console.error('Error cargarCentros:', e);
  }
}
cargarCentros();

// Mostrar/ocultar form nuevo centro
document.getElementById('btn-nuevo-centro').onclick = () =>
  document.getElementById('nuevo-centro-form').classList.remove('hidden');
document.getElementById('cancelar-nuevo-centro').onclick = () =>
  document.getElementById('nuevo-centro-form').classList.add('hidden');

// Guardar nuevo centro
document.getElementById('guardar-nuevo-centro').onclick = async function() {
  const nombre = document.getElementById('nuevo-centro-nombre').value.trim();
  if (!nombre) return alert("El nombre es obligatorio");

  const { data, error } = await supabase
    .from('centros_medicos')
    .insert([{
      nombre,
      direccion: document.getElementById('nuevo-centro-direccion').value.trim(),
      telefono: document.getElementById('nuevo-centro-telefono').value.trim(),
      email: document.getElementById('nuevo-centro-email').value.trim(),
      notas: document.getElementById('nuevo-centro-notas').value.trim(),
      activo: true
    }])
    .select('id, nombre')
    .single();

  if (!error && data) {
    await cargarCentros();
    document.getElementById('centro-agenda').value = data.id;
    document.getElementById('nuevo-centro-form').classList.add('hidden');
    ['nuevo-centro-nombre','nuevo-centro-direccion','nuevo-centro-telefono','nuevo-centro-email','nuevo-centro-notas']
      .forEach(id=> document.getElementById(id).value = '');
    validarCamposAgenda();
  } else {
    console.error('Error creando centro:', error);
    alert('Error al crear centro médico');
  }
};

// ------ Validaciones mínimas (como antes)
const campos_requeridos = ['nombre-agenda', 'fecha-inicio', 'fecha-fin','centro-agenda'];
campos_requeridos.forEach(id => {
  document.getElementById(id).addEventListener('input', validarCamposAgenda);
});
function validarCamposAgenda() {
  const completo = campos_requeridos.every(id => document.getElementById(id).value);
  const btn = document.getElementById('btn-generar-agenda');
  btn.disabled = !completo;
  btn.title = completo ? "" : "Debe completar los campos obligatorios*";
}

// ------ Validación de horarios (usa tus validators)
function horarioValido() {
  let valido = true;
  DIAS.forEach((_, idx)=>{
    const habilitado = document.querySelector(`[name="hab_${idx}"]`).checked;
    if(!habilitado) return;
    const tm_ini = document.querySelector(`[name="tm_ini_${idx}"]`).value;
    const tm_fin = document.querySelector(`[name="tm_fin_${idx}"]`).value;
    const tt_ini = document.querySelector(`[name="tt_ini_${idx}"]`).value;
    const tt_fin = document.querySelector(`[name="tt_fin_${idx}"]`).value;

    if (tm_ini && tm_fin && !isValidMorning(tm_ini, tm_fin)) valido = false;
    if (tt_ini && tt_fin && !isValidAfternoon(tt_ini, tt_fin)) valido = false;
  });
  return valido;
}

// ------ Generar agenda (SIN CAMBIOS de lógica)
document.getElementById('btn-generar-agenda').onclick = async function() {
  const msg = document.getElementById('msg-agenda');
  msg.textContent = '';
  if(!horarioValido()){
    msg.textContent = "Hay horarios mal configurados o solapados.";
    return;
  }
  const nombre_agenda = document.getElementById('nombre-agenda').value.trim();
  const fecha_inicio  = document.getElementById('fecha-inicio').value;
  const fecha_fin     = document.getElementById('fecha-fin').value;
  const centro_id     = document.getElementById('centro-agenda').value;

  const bloques = [];
  DIAS.forEach((dia, idx)=>{
    if(!document.querySelector(`[name="hab_${idx}"]`).checked) return;
    const tm_ini = document.querySelector(`[name="tm_ini_${idx}"]`).value;
    const tm_fin = document.querySelector(`[name="tm_fin_${idx}"]`).value;
    if(tm_ini && tm_fin && isValidMorning(tm_ini, tm_fin)){
      bloques.push({ dia:dia.nombre, hora_inicio:tm_ini, hora_fin:tm_fin });
    }
    const tt_ini = document.querySelector(`[name="tt_ini_${idx}"]`).value;
    const tt_fin = document.querySelector(`[name="tt_fin_${idx}"]`).value;
    if(tt_ini && tt_fin && isValidAfternoon(tt_ini, tt_fin)){
      bloques.push({ dia:dia.nombre, hora_inicio:tt_ini, hora_fin:tt_fin });
    }
  });

  if(bloques.length===0){
    msg.textContent = "Seleccione al menos un día y un horario válido.";
    return;
  }

  let fechaActual = parseLocalDate(fecha_inicio);
  const fechaFin   = parseLocalDate(fecha_fin);

  msg.textContent = "Generando agenda...";
  let totalRangos = 0;

  while(fechaActual <= fechaFin){
    const diaSemanaNum = fechaActual.getDay();
    const diaMap = {1:'lunes',2:'martes',3:'miercoles',4:'jueves',5:'viernes',6:'sabado'};
    const diaSemana = diaMap[diaSemanaNum];
    if(!diaSemana) { fechaActual.setDate(fechaActual.getDate()+1); continue; }

    const bloquesDia = bloques.filter(b=>b.dia===diaSemana);
    for(const b of bloquesDia){
      const registro = {
        centro_id,
        profesional_id,
        fecha: formatLocalYMD(fechaActual),
        hora_inicio: b.hora_inicio,
        hora_fin: b.hora_fin,
        capacidad: 1,
        estado: 'disponible',
        notas: '',
        "Nombre de Agenda": nombre_agenda,
      };

      const { error: upsertError } = await supabase
        .from('agenda')
        .upsert(registro, { onConflict: ['centro_id','profesional_id','fecha','hora_inicio','hora_fin'] });

      if (upsertError) {
        console.error("Supabase upsert error:", upsertError);
        msg.textContent = "Error al crear agenda: " + upsertError.message;
        return;
      }
      totalRangos++;
    }
    fechaActual.setDate(fechaActual.getDate()+1);
  }

  msg.textContent = `Agenda generada (${totalRangos} rangos de disponibilidad).`;
  await cargarNombresAgendas(); // refresca la vista inferior (wrapper a la nueva UI)
};

// ===== NUEVA UI de agendas: búsqueda, tabla y paginación (solo lectura/eliminación) =====
const agendasUI = (() => {
  let allNames = [];   // nombres crudos (pueden repetirse)
  let unique = [];     // [{nombre, count}]
  let filtered = [];   // dataset filtrado para la tabla
  let page = 1;
  let pageSize = 5;

  const els = {
    input: document.getElementById('agenda-search-input'),
    sugg: document.getElementById('agenda-suggestions'),
    tbody: document.getElementById('agenda-table-body'),
    prev: document.getElementById('agenda-prev'),
    next: document.getElementById('agenda-next'),
    info: document.getElementById('agenda-page-info'),
    size: document.getElementById('agenda-page-size'),
    msg: document.getElementById('msg-eliminar-agenda'),
  };

  async function fetchAll() {
    els.tbody.innerHTML = `<tr><td colspan="3" style="text-align:left;padding:8px;">Cargando…</td></tr>`;
    const { data, error } = await supabase
      .from('agenda')
      .select('"Nombre de Agenda"')
      .eq('profesional_id', profesional_id);

    if (error) {
      console.error('Error al cargar agendas:', error);
      els.tbody.innerHTML = `<tr><td colspan="3" style="text-align:left;padding:8px;color:#c2001d;">Error al cargar agendas.</td></tr>`;
      unique = []; filtered = []; allNames = [];
      return;
    }

    allNames = (data || [])
      .map(r => (r['Nombre de Agenda'] || '').trim())
      .filter(n => n.length > 0);

    const map = new Map(); // nombre -> count
    for (const n of allNames) map.set(n, (map.get(n) || 0) + 1);

    unique = Array.from(map.entries()).map(([nombre, count]) => ({ nombre, count }));
    unique.sort((a, b) => a.nombre.localeCompare(b.nombre, 'es', { sensitivity: 'base' }));
    filtered = unique.slice(); // arranque sin filtros
  }

  function renderTable() {
    const total = filtered.length;
    const pages = Math.max(1, Math.ceil(total / pageSize));
    if (page > pages) page = pages;

    const start = (page - 1) * pageSize;
    const items = filtered.slice(start, start + pageSize);

    if (total === 0) {
      els.tbody.innerHTML = `<tr><td colspan="3" style="text-align:left;padding:8px;">No hay agendas.</td></tr>`;
    } else {
      els.tbody.innerHTML = items.map(item => `
        <tr>
          <td>${item.nombre}</td>
          <td style="text-align:center;">${item.count}</td>
          <td>
            <button class="btn" data-del="${encodeURIComponent(item.nombre)}">Eliminar</button>
          </td>
        </tr>
      `).join('');
    }

    const from = total === 0 ? 0 : start + 1;
    const to = Math.min(start + items.length, total);
    els.info.textContent = `${from}-${to} de ${total}`;
    els.prev.disabled = page <= 1;
    els.next.disabled = page >= pages;
  }

  function applyFilterFromInput() {
    const q = els.input.value.trim().toLowerCase();
    if (!q) filtered = unique.slice();
    else filtered = unique.filter(u => u.nombre.toLowerCase().includes(q));
    page = 1;
    renderTable();
  }

  function showSuggestions(list) {
    if (!list.length) {
      els.sugg.classList.add('hidden');
      els.sugg.innerHTML = '';
      els.input.setAttribute('aria-expanded','false');
      return;
    }
    els.sugg.innerHTML = list.map(u => `<div class="item" role="option" data-value="${u.nombre}">${u.nombre}</div>`).join('');
    els.sugg.classList.remove('hidden');
    els.input.setAttribute('aria-expanded','true');
  }

  function renderSuggestions() {
    const q = els.input.value.trim().toLowerCase();
    let list;
    if (!q) {
      // foco sin escribir -> mostrar todas (limitadas para no saturar)
      list = unique.slice(0, 50);
    } else {
      const starts = unique.filter(u => u.nombre.toLowerCase().startsWith(q));
      const contains = unique.filter(u => !u.nombre.toLowerCase().startsWith(q) && u.nombre.toLowerCase().includes(q));
      list = [...starts, ...contains];
    }
    showSuggestions(list.slice(0, 8));
  }

  function wireEvents() {
    // Buscar / filtrar
    els.input.addEventListener('input', () => { renderSuggestions(); applyFilterFromInput(); });
    els.input.addEventListener('focus', () => { renderSuggestions(); });

    // Cerrar sugerencias al clickear fuera
    document.addEventListener('click', (e) => {
      if (!els.sugg.contains(e.target) && e.target !== els.input) {
        els.sugg.classList.add('hidden');
        els.input.setAttribute('aria-expanded','false');
      }
    });

    // Click en sugerencia
    els.sugg.addEventListener('click', (e) => {
      const item = e.target.closest('.item');
      if (!item) return;
      const nombre = item.dataset.value;
      els.input.value = nombre;
      els.sugg.classList.add('hidden');
      els.input.setAttribute('aria-expanded','false');
      applyFilterFromInput();     // tabla se filtra por la selección
    });

    // Paginación y tamaño de página
    els.prev.onclick = () => { page--; renderTable(); };
    els.next.onclick = () => { page++; renderTable(); };
    els.size.onchange = () => { pageSize = parseInt(els.size.value, 10) || 5; page = 1; renderTable(); };

    // Eliminar desde la tabla
    els.tbody.addEventListener('click', async (e) => {
      const btn = e.target.closest('button[data-del]');
      if (!btn) return;
      const nombre = decodeURIComponent(btn.dataset.del);
      if (!confirm(`¿Seguro que deseas eliminar la agenda "${nombre}" y todos sus rangos?`)) return;

      const { error } = await supabase
        .from('agenda')
        .delete()
        .eq('profesional_id', profesional_id)
        .eq('"Nombre de Agenda"', nombre);

      if (error) {
        console.error("Error al eliminar agenda:", error);
        els.msg.textContent = 'Error al eliminar la agenda.';
      } else {
        els.msg.textContent = 'Agenda eliminada correctamente.';
        // Quitar del dataset local y refrescar UI
        unique = unique.filter(u => u.nombre !== nombre);
        applyFilterFromInput();   // respeta el filtro actual
      }
    });
  }

  async function reload() {
    els.msg.textContent = '';
    els.sugg.classList.add('hidden');
    page = 1;
    pageSize = parseInt(els.size.value, 10) || 5;
    await fetchAll();
    renderTable();
  }

  function init() { wireEvents(); }

  return { init, reload };
})();

// Inicializar UI inferior
agendasUI.init();

// Wrapper para mantener el nombre que ya usabas
async function cargarNombresAgendas() {
  await agendasUI.reload();
}

// Primera carga (si ya llamabas a cargarNombresAgendas() al iniciar, esto lo reemplaza)
cargarNombresAgendas();
</script>
</body>
</html>
